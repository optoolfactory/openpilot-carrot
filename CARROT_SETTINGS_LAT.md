당근설정-조향
------

조향튜닝
------
* SteerActuatorDelay(40) msec
  * 조향장치의 지연시간이다. 
  * 값이 크면 조향을 미리 하게 되어, 와리가리 현상이 생길것 같다는 생각이 든다.
  * 이 값이 틀어지면 전체적으로 튜닝이 잘 안될것으로 보인다.
  * 커브길 진입을 기준으로 튜닝하는게 좋을것같다.
   * 커브진입 시작 시 올바르게 진입을하는 지 확인하면서 튜닝한다.
   * 커브진입을 안쪽으로 시작하면 값을 낮추고, 반대인경우 값을 높인다.
   * 대략 30~40정도 나오는듯하다.
* SteerRatioCustomx0.1(0)
  * 차량마다 조향의 SteerRatio라는게 있다. 일종의 감속도라고 봐야할것 같다.
  * 감속도라고 하면 정확히 입력하면 되지만, 여러가지 변수로 인해 적당히 조절된 값으로 이용해야 맞는것 같다.
  * 오픈파일럿 스톡에서는 LiveSteerRatio로 측정치를 사용하는데, 뭔가 좀 문제가 있어보인다. 따라서, 일반적으로 고정SteerRatio를 사용한다.
  * 차량의 기본값을 참조하여 입력하도록 한다.
  * 값이 작으면 조향을 많이한다. 연속된 커브길을 운행하면서 값을 찾는것이 좋다. (당근의 디버그화면을 켜면 liveSR값이 표시되는데, 일반적으로 이값보다 90%의 값을 사용하면 맞는듯하다)
* _LateralTorqueCustom(0)
  * 조향은 일반적으로 토크제어를 한다.
  * 콤마스톡은 학습에 의해 토크제어를 하는데, 이 학습기간이 생각보다 길다. 약 40km정도를 주행해야 완료되는것 같다.
  * 하지만, 학습값도 별로 맘에들지는 않는다.
  * 이값을 1로 하면 custom값을 사용한다.
* _LateralTorqueAccelFactor*0.001(2500)
  * Custom AccelFactor값
  * 값이 작아지면 조향토크가 증가된다.
  * 계속낮춰가며, 핸들의 움직임이 둔탁해질때까지 내린다. 요기서 둔탁하지 않을정도 까지 살짝올려주면 가장좋은값이 아닌가? 라는 개인적인 생각이다.
  * 참고: 개인적인 생각으로 튜닝한것임.
* _LateralTorqueFriction*0.001(100)
  * Custom Friction값
  * 이값은 정지기동시 조향토크에 추가되는 값이다.
  * 값을 너무 크게하면 부드럽지 못한 핸들링이 되는것이 확인된다.
  * 참고: 개인적인 생각으로 튜닝한것임.
* MaxAngleFrames(89)
  * 현기차는 조향제어시 일정 각도를 넘어가면, Steering fault가 난다고한다. 이때, 강제로 fault신호를 주기적으로 넣어주면 증상이 없어진다.
  * 기본값은 89이지만, 차량에 따라 85정도를 넣어야 안나는 차량도 있다고 한다.
  * 그냥 87정도 넣어놓자..

조향튜닝(차선추적모드)
------
* 차선추적모드란?
  * 콤마는 차선추적기능을 삭제하였다. 이 기능을 사용하지 않아도 충분히 좋은 성능을 낸다.
  * 상황에 따라서 이기능이 필요한경우가 있어서 넣게 되었다.
  * 이 기능을 활성화하면, 콤마모델에서 제공하는 lateral planner를 사용하지 않고, 과거의 lateral planner를 사용하게 된다.
* 당근 차선 추적모드의 특징
  * 가장자리 차선의 경우 좀더 가장자리로 주행하도록 유도한다. (AdjustLaneOffset)
  * 커브길의 경우 안쪽으로 유도한다. (AdjustCurveOffset)
  * 차선이 일시적으로 1개만 나오는 경우 약 5초간 차선폭값을 유지하도록 하여, 정상적인 차선추적이 가능하도록 함. 이후에는 속도에 따른 가상의 차선폭을 만들어 차선을 따라가게 된다.
* 차선추적모드활성화
  * Laneline mode speed(0) km/h
    * 0으로 설정하면, 비활성화 되며 콤마의 모델 조향 플래너를 사용하게 된다.
    * 1이상으로 설정하면 차선추적모드가 활성화된다.
      * 50으로 설정하면, 50이하의 속도에서는 콤마가 제공하는 주행경로를 따라가며, 그이상의 속도에서는 차선을 따라가게 된다.
      * 양쪽 차선이 보이지 않거나, 차선변경시 콤마가 제공하는 주행경로를 따라간다.
  * AdjustLaneOffset (0) cm
    * 도로의 끝차선에서 주행하고 있을때, 지정된 거리만큼 살짝 주행경로를 이동시켜 안정된 주행이 되도록 유도한다.
    * 좌우차선이 넓거나 좁으면 작동하지 않는다.
    * 주행차선이 좁으면, 작동하지 않는다.
  * AdjustCurveOffset (0) cm
    * 커브길을 만나면 안쪽으로 경로를 이동하여, 안정된 커브가 되도록 유도한다.

